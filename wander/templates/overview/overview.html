{% extends "base.html" %}

{% block content %}
<div id="header">
  <span>
    <input type="radio" name="timeperiod"
           value="months" onclick="set_time_period(this);"> Months
    <input type="radio" name="timeperiod"
           value="weeks" onclick="set_time_period(this);"
           checked="checked"> Weeks
    <input type="radio" name="timeperiod"
           value="days" onclick="set_time_period(this);"> Days
  </span>

  <span style="float:right">
    Region:
    <input type="checkbox" name="America"
           value="america">America
    <input type="checkbox" name="Europe"
           value="europe">Europe
    <input type="checkbox" name="Asia"
           value="asia">Asia
    <input type="checkbox" name="Total"
           value="total" checked="checked">Total<br>
  </span>

  <script>
    /* todo: get divs automatically */
    var plots = ["revenue", "regs", "inst_to_regs_conv",
                 "first_sales", "regs_to_first_sales_conv",
                 "sales", "first_sales_to_second_sales_conv"];

    function set_time_period(radio_btn) {
        for(let i = 0; i < plots.length; i++){
            plot_endpoint_and_div = plots[i];

            jQuery.post(
                '/overview/' + plot_endpoint_and_div,
                {time_period: radio_btn.value}
            ).done(function(response) {
                console.log(response)
                /*use Plotly.restyle instead of Plotly.newPlot*/
                Plotly.newPlot(plot_endpoint_and_div, JSON.parse(response));
            }).fail(function() {
                console.log("Can't get data from the server")
            })
        }
    }
  </script>
</div>

<div>
  <!-- Use CSS instead of space-formatting -->
  <br>
  <br>
  <br>
</div>

<div id="revenue"></div>
<script>
  Plotly.newPlot("revenue", {{plots.revenue | safe}});
</script>

<div>
  <!-- Use CSS instead of space-formatting -->
  <br>
</div>

<div>
  <div id="regs" style="width:47%; float:left;"></div>
  <div id="inst_to_regs_conv" style="width:47%; float:right;"></div>
</div>
<script>
  Plotly.newPlot("regs", {{plots.regs | safe}});
  Plotly.newPlot("inst_to_regs_conv", {{plots.inst_to_regs_conv | safe}});
</script>

<div>
  <div id="first_sales" style="width:47%; float:left;"></div>
  <div id="regs_to_first_sales_conv" style="width:47%; float:right;"></div>
</div>
<script>
  Plotly.newPlot("first_sales",
                 {{plots.first_sales | safe}});
  Plotly.newPlot("regs_to_first_sales_conv",
                 {{plots.regs_to_first_sales_conv | safe}});
</script>

<div>
  <div id="sales" style="width:47%; float:left;"></div>
  <div id="first_sales_to_second_sales_conv" style="width:47%; float:right;"></div>
</div>
<script>
  Plotly.newPlot("sales", {{plots.sales | safe}});
  Plotly.newPlot("first_sales_to_second_sales_conv",
                 {{plots.first_sales_to_second_sales_conv | safe}});
</script>


{% endblock %}
